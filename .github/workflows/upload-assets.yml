name: Upload Assets
on: [push]
jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4  # Updated to the latest version

    - name: Set up Git user
      run: |
        echo "Setting up Git user"
        git config --global user.name "CyanRayyan"
        git config --global user.email "1dangmax@hdsb.ca"
        git config --global user.name
        git config --global user.email
        echo "Git user set up completed"

    - name: Create assets directory
      run: |
        echo "Creating assets directory"
        mkdir -p assets
        ls -l
        echo "Assets directory created"

    - name: Download and extract assets
      run: |
        echo "Downloading and extracting assets"
        cd assets
        wget -qO- "https://dl.dropboxusercontent.com/scl/fi/fbuiy99tb218akvy6u9bg/Potato-By-Tyler-Dang.zip?dl=1" | tar -xz
        echo "Assets downloaded and extracted"
        ls -l
        cd ..
        
    - name: Debug directory structure
      run: |
        echo "Current directory structure:"
        ls -R

    - name: Commit and push assets
      env:
        GITHUB_TOKEN: ${{ secrets.POTATO_KEY }}
      run: |
        echo "Starting Git operations"
        git add .
        git status  # Debugging to see what files are staged
        git commit -m "Add assets" || { echo "No changes to commit"; exit 0; }  # Handle no changes scenario without failing
        git push || { echo "Push failed"; exit 1; }
        echo "Git operations completed"
